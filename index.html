<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>BubbleChat</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #4f4f4f;
        font-family: 'Press Start 2P', monospace;
        image-rendering: pixelated;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    @font-face {
        font-family: 'Press Start 2P';
        src: url('https://fonts.gstatic.com/s/pressstart2p/v11/e3t4euO8T-267oIAQAu6jDQyK3nC4w.ttf');
    }

    .window {
        width: 90%;
        height: 90%;
        background: #222;
        border: 4px solid #000;
        padding: 10px;
        display: flex;
        flex-direction: column;
    }

    h1 {
        text-align: center;
        font-size: 20px;
        margin-bottom: 10px;
        color: #fff;
        text-shadow: 0 0 4px #000;
    }

    #messages {
        flex: 1;
        overflow-y: auto;
        background: #333;
        border: 3px solid #000;
        padding: 8px;
        font-size: 12px;
    }

    .nick {
        cursor: pointer;
    }

    input, button {
        padding: 8px;
        background: #111;
        border: 2px solid #000;
        color: #fff;
        font-family: inherit;
    }
</style>
</head>
<body>
<div class="window">
    <h1>BubbleChat</h1>

    <div id="login">
        <input id="nick" type="text" placeholder="Введите ник" />
        <button onclick="enterChat()">Войти</button>
    </div>

    <div id="chat">
        <div id="messages"></div>
        <div id="msgInput">
            <input id="text" type="text" placeholder="Сообщение..." />
            <button onclick="sendMsg()">OK</button>
        </div>
    </div>
</div>

<script>
let nickname = "";
let ws = new WebSocket("ws://localhost:3000");

ws.onmessage = (msg) => {
    const box = document.getElementById("messages");
    const div = document.createElement("div");

    let text = msg.data;

    // сохраняем цвет ника в словаре
    window.nickColors = window.nickColors || {};

    if (text.includes(":")) {
        const nick = text.split(":")[0];

        if (!window.nickColors[nick]) {
            window.nickColors[nick] = '#' + Math.floor(Math.random()*16777215).toString(16);
        }

        const nickSpan = document.createElement("span");
        nickSpan.textContent = nick;
        nickSpan.style.color = window.nickColors[nick];
        nickSpan.className = "nick";
        nickSpan.onclick = () => {
            document.getElementById("text").value = "@" + nick + " ";
        };

        const msgSpan = document.createElement("span");
        msgSpan.textContent = text.substring(nick.length + 1);

        div.appendChild(nickSpan);
        div.appendChild(document.createTextNode(":"));
        div.appendChild(msgSpan);
    } else {
        div.style.color = "#ddd";
        div.textContent = text;
    }

    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
};
};

function enterChat() {
    const n = document.getElementById("nick").value.trim();
    if (!n) return;
    nickname = n;

    document.getElementById("login").style.display = "none";
    document.getElementById("chat").style.display = "flex";

    ws.send("[SYSTEM] " + nickname + " вошёл в чат");
}

function sendMsg() {
    const txt = document.getElementById("text").value.trim();
    if (!txt) return;
    ws.send(nickname + ": " + txt);
    document.getElementById("text").value = "";
}
</script>

</body>
</html>
