<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>BubbleChat</title>

<style>
    body {
        background: #0a0a0a;
        color: #00ff00;
        font-family: 'Press Start 2P', monospace;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        image-rendering: pixelated;
    }

    @font-face {
        font-family: 'Press Start 2P';
        src: url('https://fonts.gstatic.com/s/pressstart2p/v11/e3t4euO8T-267oIAQAu6jDQyK3nC4w.ttf');
    }

    .window {
        width: 420px;
        background: #000;
        border: 4px solid #33ff33;
        padding: 10px;
        box-shadow: 0 0 25px #33ff33;
    }

    h1 {
        text-align: center;
        font-size: 18px;
        margin-bottom: 10px;
        color: #33ff33;
        text-shadow: 0 0 6px #0f0;
    }

    #login {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    input {
        padding: 6px;
        background: #111;
        border: 2px solid #0f0;
        color: #0f0;
        font-family: inherit;
    }

    button {
        padding: 6px;
        background: #0f0;
        border: none;
        font-weight: bold;
        cursor: pointer;
    }

    #chat {
        display: none;
        flex-direction: column;
        gap: 10px;
    }

    #messages {
        height: 260px;
        background: #050505;
        border: 3px solid #33ff33;
        overflow-y: auto;
        padding: 5px;
        font-size: 12px;
        image-rendering: pixelated;
    }

    .nick {
        cursor: pointer;
        text-decoration: underline;
    }
</style>

</head>
<body>

<div class="window">
    <h1>BubbleChat</h1>

    <div id="login">
        <input id="nick" type="text" placeholder="Введите ник" />
        <button onclick="enterChat()">Войти</button>
    </div>

    <div id="chat">
        <div id="messages"></div>
        <div id="msgInput">
            <input id="text" type="text" placeholder="Сообщение..." />
            <button onclick="sendMsg()">OK</button>
        </div>
    </div>
</div>

<script>
// Автоматическое подключение к вебсокету Render
let ws = new WebSocket("wss://" + window.location.host);
let nickname = "";

ws.onmessage = (msg) => {
    const box = document.getElementById("messages");
    const div = document.createElement("div");

    let text = msg.data;

    if (text.includes(":")) {
        const nick = text.split(":")[0];
        const color = "#" + Math.floor(Math.random()*16777215).toString(16);

        const nickSpan = document.createElement("span");
        nickSpan.textContent = nick;
        nickSpan.style.color = color;
        nickSpan.className = "nick";
        nickSpan.onclick = () => {
            document.getElementById("text").value = "@" + nick + " ";
        };

        const msgSpan = document.createElement("span");
        msgSpan.textContent = text.substring(nick.length + 1);

        div.appendChild(nickSpan);
        div.appendChild(document.createTextNode(":"));
        div.appendChild(msgSpan);
    } else {
        div.style.color = "#33ffff";
        div.textContent = text;
    }

    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
};

function enterChat() {
    const n = document.getElementById("nick").value.trim();
    if (!n) return;

    nickname = n;

    document.getElementById("login").style.display = "none";
    document.getElementById("chat").style.display = "flex";

    ws.send("[SYSTEM] " + nickname + " вошёл в чат");
}

function sendMsg() {
    const txt = document.getElementById("text").value.trim();
    if (!txt) return;

    ws.send(nickname + ": " + txt);
    document.getElementById("text").value = "";
}
</script>

</body>
</html>
